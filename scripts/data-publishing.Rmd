---
title: "Summer of Data - Data Publishing"
date: "`r Sys.Date()`"
output: 
  html_document:
    df_print: default
    number_sections: no
    self_contained: no
    toc: yes
    toc_float:
      collapsed: no
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,message=FALSE, warning=FALSE)
```

```{r source-libraries, include=FALSE}
source("libraries.R")
```

<hr> 

```{r read-state-files, include=FALSE}

state_file_dir <- "../data/final-files-nluo/state_files/csv/v2/"
all_state_files <- dir(state_file_dir)

state_df <- c()
for(i in 1:length(all_state_files)){
  state_file <- all_state_files[[i]]
  state_file_path <- glue::glue("{state_file_dir}{state_file}")
  sf <- readr::read_csv(state_file_path,col_types = cols(.default = "c"))
  sf$courtTitle <- state_file
  state_df <- dplyr::bind_rows(sf, state_df)
}

state_df$Gender <- stringr::str_to_title(state_df$Gender)
state_df$courtTitle <- stringr::str_replace_all(string = state_df$courtTitle, pattern = "KHOJ_",replacement = "") %>% stringr::str_replace_all(pattern = "\\.csv",replacement = "")

# judge_master <-
#   readr::read_csv("../data/final-files-nluo/judges_master_file.csv",
#                   col_types = cols(.default = "c"))
```

```{r std_master_files, eval=FALSE, include=FALSE}

# This section is used to standardise court names across multiple columns

std_parent_hc <- data.frame("phc"=c("Allahabad", "Bombay", "Punjab & Haryana", "Uttrakhand", "Punjab and haryana", "Andra Pradesh", "Calcutta", "Andhra Pradesh", "Patna", "Rajasthan", "Madhya Pradesh", "Karnataka", "Punjab and Haryana", "Gujarat", "Orissa", "Delhi", "Jharkhand", "Chhatisgarh", "Himachal Pradesh", "Sikkim", "J&K and Ladakh", "Gujarat High Court", "Madaras", "Sikkim High Court", "Punjab and Haryana high court", "Andhra Pradesh High Court", "Bombay High Court", "Calcutta High Court", "Delhi High Court", "Jammu and Kashmir", "Madras", "Madaras High Court", "Tamil Nadu", "Punjab & Harayana", "Kerala", "Gauhati", "Calcuta", "Chhattisgarh", "Guwahati", "Andhra Pradesh (Hyderabad)", "Manipur", "Uttarakhand", "Panjab & Haryana", "Jammu and Kashmir and Ladakh", "Jammu & Kashmir", "madras", "Chattisgarh", "Andhar Pradesh", "Himanchal Pradesh", "Meghalaya", "Guahati", "Odisha", "Punjaba and Haryana", "Hyderabad", "Telangana", "Tripura"),
                            "phc_updated"=c("Allahabad", "Bombay", "PunjabandHaryana", "Uttarakhand", "PunjabandHaryana", "AndhraPradesh", "Calcutta", "AndhraPradesh", "Patna", "Rajasthan", "MadhyaPradesh", "Karnataka", "PunjabandHaryana", "Gujarat", "Orissa", "Delhi", "Jharkhand", "Chhattisgarh", "HimachalPradesh", "Sikkim", "J&KandLadakh", "Gujarat", "Madras", "Sikkim", "PunjabandHaryana", "AndhraPradesh", "Bombay", "Calcutta", "Delhi", "J&KandLadakh", "Madras", "Madras", "Madras", "PunjabandHaryana", "Kerala", "Gauhati", "Calcutta", "Chhattisgarh", "Gauhati", "AndhraPradesh", "Manipur", "Uttarakhand", "PunjabandHaryana", "J&KandLadakh", "J&KandLadakh", "Madras", "Chhattisgarh", "AndhraPradesh", "HimachalPradesh", "Meghalaya", "Gauhati", "Orissa", "PunjabandHaryana", "AndhraPradesh", "Telangana", "Tripura")
)

std_transfer_1 <- data.frame("transfer_1"=c("allahabad", "Allahabad", "Andhra Pradesh", "Andhra Pradesh (Hyderabad)", "Andhra Pradesh HC", "Andra Pradesh", "Bombay", "Calcutta", "Chhatisgarh", "Chhattisgarh", "Delhi", "Gauhati", "Guahati", "Gujarat", "Gujrat", "Guwahati", "High Court of Judicature for the state of Telangana and Andhra Pradesh", "High Court of Karnataka", "Himachal Pradesh", "Hyderabad", "J&K", "J&K  and Ladakh", "J&K and Ladakh", "Jammu & Kashmir", "Jammu and Kashmir", "Jammu and Kashmir High Court", "Jharkhand", "Karnatak", "Karnataka", "Kerala", "Kerela High Court", "Madaras", "Madaras High Court", "Madhya Pradesh", "Madras", "Manipur", "Meghalaya", "Mumbai", "Orissa", "Orrisa", "Patna", "Punjab & Haryana", "Punjab & Haryana HC", "Punjab and Harayana", "Punjab and Harya", "Punjab and Haryana", "Punjab and Haryana, Chandigarh High Court", "Rajasthan", "Rajisthan", "Sikkim", "Telangana", "Telengana", "Tripura", "Uttarakhand", "Uttarakhand High Court", "Uttrakhand"),
                             "transfer_1_updated"=c("Allahabad", "Allahabad", "AndhraPradesh", "AndhraPradesh", "AndhraPradesh", "AndhraPradesh", "Bombay", "Calcutta", "Chhattisgarh", "Chhattisgarh", "Delhi", "Gauhati", "Gauhati", "Gujarat", "Gujarat", "Gauhati", "Telangana", "Karnataka", "HimachalPradesh", "AndhraPradesh", "J&KandLadakh", "J&KandLadakh", "J&KandLadakh", "J&KandLadakh", "J&KandLadakh", "J&KandLadakh", "Jharkhand", "Karnataka", "Karnataka", "Kerala", "Kerala", "Madras", "Madras", "MadhyaPradesh", "Madras", "Manipur", "Meghalaya", "Bombay", "Orissa", "Orissa", "Patna", "PunjabandHaryana", "PunjabandHaryana", "PunjabandHaryana", "PunjabandHaryana", "PunjabandHaryana", "PunjabandHaryana", "Rajasthan", "Rajasthan", "Sikkim", "Telangana", "Telangana", "Tripura", "Uttarakhand", "Uttarakhand", "Uttarakhand")
)

std_transfer_2 <- data.frame("transfer_2"=c("Allahabad", "Andhra Pradesh", "Andhra Pradesh and Telangana", "Bombay", "Calcutta", "Chattisgarh", "Chhattisgarh", "Delhi", "Delhi High Court", "Gauhati", "Gujarat", "High Court of Judicature for the state of Telangana and Andhra Pradesh", "Himachal Pradesh", "J&K and Ladakh", "Jammu and Kashmir", "Jharkhand", "karnataka", "Karnataka", "Kartaka", "Kerala", "Kerela", "Madhya Pradesh", "Madras", "Manipur", "Orissa", "Patna", "Punjab & Haryana", "Punjab and Harya", "Punjab and Haryana", "Punjab And Haryana", "Punjab and Haryana High Court", "Rajasthan", "Sikkim", "Telangana", "Uttarakhand")
,
                             "transfer_2_updated"=c("Allahabad", "AndhraPradesh", "Telangana", "Bombay", "Calcutta", "Chhattisgarh", "Chhattisgarh", "Delhi", "Delhi", "Gauhati", "Gujarat", "Telangana", "HimachalPradesh", "J&KandLadakh", "J&KandLadakh", "Jharkhand", "Karnataka", "Karnataka", "Karnataka", "Kerala", "Kerala", "MadhyaPradesh", "Madras", "Manipur", "Orissa", "Patna", "PunjabandHaryana", "PunjabandHaryana", "PunjabandHaryana", "PunjabandHaryana", "PunjabandHaryana", "Rajasthan", "Sikkim", "Telangana", "Uttarakhand")
)

std_transfer_3 <- data.frame("transfer_3"=c("Allahabad", "Allahabad High Court", "Chattisgarh", "Delhi", "Gujarat", "Jammu and Kashmir", "Madhya Pradesh", "Madras", "Meghalaya", "Orissa", "Patna", "Rajasthan", "Sikkim", "Uttarakhand")
,
                             "transfer_3_updated"=c("Allahabad", "Allahabad", "Chhattisgarh", "Delhi", "Gujarat", "J&KandLadakh", "MadhyaPradesh", "Madras", "Meghalaya", "Orissa", "Patna", "Rajasthan", "Sikkim", "Uttarakhand")
)

judge_master <- left_join(judge_master, std_parent_hc, by=c("Parent High Court"="phc"))

judge_master <- left_join(judge_master, std_transfer_1, by=c("If yes, which High Court 1"="transfer_1"))

judge_master <- left_join(judge_master, std_transfer_2, by=c("If yes, which High Court 2"="transfer_2"))

judge_master <- left_join(judge_master, std_transfer_3, by=c("If yes, which High Court 3"="transfer_3"))

readr::write_csv(judge_master,"../data/final-files-nluo/judges_master_updated_cols.csv")
```

```{r Read files for analysis, include=FALSE}

# Change this variable if using a different file for generating insights
data_for_analysis_path <- "../data/shared-by-smita/KHOJ MASTER FINAL.csv"
data_for_analysis <-
  readr::read_csv(data_for_analysis_path, col_types = cols(.default = "c"))
data_for_analysis$`Foreign Degree in Law` <- stringr::str_to_title(data_for_analysis$`Foreign Degree in Law`)
data_for_analysis$`Post-Graduate in Law` <- stringr::str_to_title(data_for_analysis$`Post-Graduate in Law`)
```

<!-- ### Download Files -->

<!-- 1. [Consolidated master file of Judges - OI](https://raw.githubusercontent.com/justicehub-in/summer-of-data-chapter-1/main/data/final-files-nluo/judges_master_file.csv) _(Right click > Save link as)_ -->

<!-- 2. [State level files](https://github.com/justicehub-in/summer-of-data-chapter-1/tree/main/data/final-files-nluo/csv) -->
<!-- _(Click on File > Click on Raw > Right click > Save link as)_ -->

<!-- <hr>  -->

### Q1 - Total number of judges by state

Total number of judges in each state level file. Here we are only counting the number of rows in each file. 

[Visual](https://www.datawrapper.de/_/3xI7Q/) 

```{r total-judges-per-court, echo=FALSE}

total_judges_per_court <- state_df %>% group_by(courtTitle) %>% summarise(total=n())

DT::datatable(
  total_judges_per_court,
  filter = 'top',
  options = list(autoWidth = TRUE)
)
```

### Q2 - Distribution of judges by cadre

[Visual](https://www.datawrapper.de/_/szxYA/)

```{r judges-by-cadre, echo=FALSE}

cadre_dist <- data_for_analysis %>% group_by(Cadre) %>% summarise(total=n()) %>% mutate(percent=round(total/sum(total)*100,2))
cadre_dist$Cadre[is.na(cadre_dist$Cadre)] <- "Not Available"
DT::datatable(
  cadre_dist,
  options = list(autoWidth = TRUE)
)
```

### Q3 - Distribution of judges by cadre in each state

[Visual](https://www.datawrapper.de/_/m1Hkx/)

**Some discrepancies here**

```{r state-wise-judges-by-cadre, echo=FALSE, warning=FALSE}

cadre_dist_state <- state_df %>% group_by(courtTitle, Cadre) %>% summarise(total=n())
cadre_dist_state <- cadre_dist_state %>% tidyr::pivot_wider(names_from = Cadre, values_from = total)
cadre_dist_state <- cadre_dist_state[,c("courtTitle","Bar","Service","Not Available")]
cadre_dist_state <-
  cadre_dist_state %>% mutate(
    bar_percent = round(Bar / (Bar + Service) * 100, 2),
    service_percent = round(Service /
                              (Bar + Service) * 100, 2)
  )

cadre_dist_state$service_cat <- "lt30"
cadre_dist_state$service_cat[cadre_dist_state$service_percent>=30] <- "mt30"

cadre_dist_state$bar_percent <- NULL
cadre_dist_state$service_percent <- NULL


DT::datatable(
  cadre_dist_state,
  options = list(autoWidth = TRUE)
)
```

### Q4 - Gender distribution of judges in each state

[Visual](https://www.datawrapper.de/_/YFEO6/)

```{r gender-distribution, echo=FALSE}

gender_dist_state <- state_df %>% group_by(courtTitle, Gender) %>% summarise(total=n())

gender_dist_state <- gender_dist_state %>% tidyr::pivot_wider(names_from = Gender, values_from = total) %>% mutate(total=Male+Female, femalePercent=round(Female/total*100,2))

DT::datatable(
  gender_dist_state,
  options = list(autoWidth = TRUE)
)

```

### Q5 - Overall Service Cadre Judges with High Court experience
```{r service-cadre-high-court, include=FALSE}

service_cadre_with_hc_admin <- data_for_analysis[data_for_analysis$Cadre == "Service" & data_for_analysis$`Experience in High Court Administrative Post` %in% c("Yes","yes"),]
```

There are `r nrow(service_cadre_with_hc_admin)` judges who have experience working in a High Court administrative post and belong to a service cadre

### Q6 - 1 - Transfers from Parent High Court

_Note: Here we are only counting transfers from Parent High Court_

[Visual](https://www.datawrapper.de/_/NMgJl/)

```{r judge-transfers, echo=FALSE}
transfer_from <- data_for_analysis %>% filter(`If transferred to any other High Court` == "Yes") %>% group_by(`Parent High Court`) %>% summarise(total_transfers = n())

DT::datatable(
  transfer_from,
  filter = 'top',
  options = list(autoWidth = TRUE)
)


```

### Q6 - 2 - Transfer to High Court

[Visual](https://www.datawrapper.de/_/qISLd/)

```{r transfer-to, echo=FALSE}

transfer_1 <- data_for_analysis[,c("fileTitle","Parent High Court","If yes, which High Court 1")]
names(transfer_1)[] <- c("fileTitle","HC_from","HC_to")
transfer_1 <- transfer_1[!is.na(transfer_1$HC_to),]

transfer_2 <- data_for_analysis[,c("fileTitle","If yes, which High Court 1","If yes, which High Court 2")]
names(transfer_2)[] <- c("fileTitle","HC_from","HC_to")
transfer_2 <- transfer_2[!is.na(transfer_2$HC_to),]

transfer_3 <- data_for_analysis[,c("fileTitle","If yes, which High Court 2","If yes, which High Court 3")]
names(transfer_3)[] <- c("fileTitle","HC_from","HC_to")
transfer_3 <- transfer_3[!is.na(transfer_3$HC_to),]

transfer_df <- bind_rows(transfer_1, bind_rows(transfer_2, transfer_3))
transfers_to <- transfer_df %>% group_by(HC_to) %>% summarise(total=n())

DT::datatable(
  transfers_to,
  filter = 'top',
  options = list(autoWidth = TRUE)
)
```

### Q6 - 3 - Number of transfers 

[Visual](https://www.datawrapper.de/_/oIhKs/)

```{r num-judge-transfers, echo=FALSE}

transferred_any <- data_for_analysis %>% filter(`If transferred to any other High Court` == "Yes")
transferred_any$total_transfers <-
  ifelse(!is.na(transferred_any$`If yes, which High Court 3`),
         3,
         ifelse(
           !is.na(transferred_any$`If yes, which High Court 2`),
           2,
           ifelse(!is.na(
             transferred_any$`If yes, which High Court 1`
           ), 1, 1)
         ))
times_transfer <-
  transferred_any %>% group_by(total_transfers) %>% summarise(total = n())

DT::datatable(
  times_transfer,
  options = list(autoWidth = TRUE)
)


```

### Q7 - Private empanelment and prior litigation experience

**Some discrepency here**

```{r empanelment-litigation, echo=FALSE, message=FALSE, warning=FALSE}
state_df$`Litigation Experience` <- stringr::str_to_title(state_df$`Litigation Experience`)

state_df$`If empanelled by Private Companies` <- stringr::str_to_title(state_df$`If empanelled by Private Companies`)

emp_lit_prior <-
  state_df %>% group_by(courtTitle, `Litigation Experience`, `If empanelled by Private Companies`) %>% summarise(total = n())
emp_lit_prior <- emp_lit_prior[emp_lit_prior$`Litigation Experience` == "Yes",]
emp_lit_prior <- emp_lit_prior[!is.na(emp_lit_prior$courtTitle),]

emp_lit <- emp_lit_prior %>% tidyr::pivot_wider(names_from = "If empanelled by Private Companies", values_from = "total") 

total_lit_exp <- emp_lit_prior %>% group_by(courtTitle) %>% summarise(priorLitExperience=sum(total))

emp_lit$`Litigation Experience` <- NULL

emp_lit <- left_join(emp_lit, total_lit_exp, by="courtTitle")

DT::datatable(
  emp_lit,
  filter = 'top',
  options = list(autoWidth = TRUE)
)

```

### Q8 - School and Law Degree data availability

**Some discrepancy here**

```{r school-law-deg-info, echo=FALSE, message=FALSE, warning=FALSE}

school_na <- data_for_analysis %>% filter(is.na(`Schooling Information`)) %>% group_by(fileTitle) %>% summarise(school_info_na=n())

law_deg_na <- data_for_analysis %>% filter(is.na(`Law Degree Institution`)) %>% group_by(fileTitle) %>% summarise(law_degree_info_na=n())

total_judges <- data_for_analysis %>% group_by(fileTitle) %>% summarise(totalJudges=n())

info_na <-
  left_join(school_na, left_join(law_deg_na, total_judges, by = NULL), by =
              NULL)
DT::datatable(
  info_na,
  filter = 'top',
  options = list(autoWidth = TRUE)
)

```

### Q10 - Foreign Education Degree
```{r foreign-edu, echo=FALSE, message=FALSE, warning=FALSE}
fdl <- data_for_analysis %>% group_by(fileTitle, `Foreign Degree in Law`) %>% summarise(total=n()) %>% pivot_wider(names_from = `Foreign Degree in Law`,values_from = total)

DT::datatable(
  fdl,
  filter = 'top',
  options = list(autoWidth = TRUE)
)

```

### Q11 - PG Degree
```{r pg-degree, echo=FALSE, message=FALSE, warning=FALSE}
pgdl <- data_for_analysis %>% group_by(fileTitle, `Post-Graduate in Law`) %>% summarise(total=n()) %>% pivot_wider(names_from = `Post-Graduate in Law`,values_from = total)

DT::datatable(
  pgdl,
  filter = 'top',
  options = list(autoWidth = TRUE)
)

```

### Q12 - Chief Justices Cadre
```{r chief-justices, echo=FALSE, message=FALSE, warning=FALSE}
total_cj <- data_for_analysis %>% filter(`If appointed Chief Justice in another High Court` == "Yes") %>% nrow

total_female_cj <- data_for_analysis %>% filter(`If appointed Chief Justice in another High Court` == "Yes" & Gender == "Female") %>% nrow

cj_cadre <- data_for_analysis %>% filter(`If appointed Chief Justice in another High Court` == "Yes") %>% group_by(Cadre) %>% summarise(total=n()) %>% pivot_wider(names_from=Cadre, values_from=total)

DT::datatable(
  cj_cadre,
  options = list(autoWidth = TRUE)
)
```

Total CJ's - `r total_cj`

Female CJ's - `r total_female_cj`

